h1. Introduction 

hbase-ec2 is a "Ruby":http://ruby-lang.org library to help manage a set of "Amazon EC2":http://aws.amazon.com/ instances as a single "HBase":http://hbase.apache.org cluster.

"YCSB":https://github.com/brianfrankcooper/YCSB is a framework and common set
of workloads for evaluating the performance of different "key-value"
and "cloud" serving stores. It can support HBase, Cassandra, MongoDB, and Voldemort now.

This package is derived from HBase EC2 script, and support to run YCSB tests against 
a HBase cluster deployed at EC2. 

h2. Credits
* Andrew Purtell: original developer
* Eugene Koontz: added Ruby support
* Yahoo: YCSB 

h1. Contents

hbase-ec2 is currently supplied as a set of ruby files that currently is :

* lib/hcluster.rb : the Hadoop::HCluster and Hadoop::HImage class definitions
* lib/YcsbCluster.rb : a subclass of HCluster, intended for testing HBase 
functionality with YCSB.
* recipes/ycsb.rb : a recipe to invoke HBase + YCSB cluster.

h1. Prerequisites

* @export RUBYOPT="rubygems"@
* Download and install the EC2 AMI and API tools

pre.
su - root
cd /opt
mkdir aws
cd aws
wget http://s3.amazonaws.com/ec2-downloads/ec2-ami-tools.zip
unzip ec2-ami-tools.zip
wget http://s3.amazonaws.com/ec2-downloads/ec2-api-tools.zip
unzip ec2-api-tools.zip
ln -s ec2-ami-tools-* ec2-ami-tools
ln -s ec2-api-tools-* ec2-api-tools
rm *.zip

* An Amazon EC2 account. You must add the following to your environment prior to starting irb:
* Ruby support
* sudo apt-get install irb
* sudo apt-get install rubygems
* sudo gem install net-ssh
* sudo gem install net-scp
* sudo gem install amazon-ec2
* sudo gem install aws-s3
* sudo gem install git
* sudo gem install aws
* sudo gem install net-smtp


pre. 
export AWS_ACCESS_KEY_ID=...
export AWS_SECRET_ACCESS_KEY=...
export AWS_ACCOUNT_ID=...

* A EC2 key pair called "root". This should be stored in your home directory in @~/.ec2/root.pem@.

h2. Optional configuration

You can edit the ycsb.rb file to configure the test. 

h1. Downloading hbase-ec2

pre. 
git clone git://github.com/mlai/hbase-ec2.git ~/hbase-ec2
git checkout --track -b origin/ycsb ycsb

h1. Usage

There are 2 options for you to execute the script:
* Interactive Ruby shell
* Run with a batch 

h2. Run as a command

Use the ycsb recipe to start and stop the test.

You need to edit the recipes/ycsb.rb to configure your cluster and test.

pre.
$ bin/ec2sh recipes/ycsb.rb

It will:
* start the cluster at EC2
* start Hadoop 
* check HBase code changes: if there is new changes, build HBase jar locally, and upload the jar to the cluster.
* start HBase
* start YCSB test
* collect YCSB test result, and perform test result analysis
* send email to configured recipients
* terminate the cluster at EC2


h2. Run with shell

Preliminaries

pre. 
$ bin/ec2sh
>> $:.unshift("~/hbase-ec2/lib")
=> ["~/hbase-ec2/lib", ...]
>> load 'YcsbCluster.rb'
...

